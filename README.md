# Traceroute2Fluentd

## How to start

Я рекомендую использовать [Docker-образ](https://hub.docker.com/r/drf4ust/tracert2fluent) приложения, к которму монтируется как volume конфигурационный файл.
Пример `docker-compose.yml`:

```yaml
version: '3'

services:

  fluentd:
    build: ./build/fluentd
    container_name: fluentd
    restart: always
    volumes:
      - ./conf/fluentd:/fluentd/etc
    ports:
      - "24224:24224"

  tracert:
    image: drf4ust/tracert2fluent:latest
    container_name: tracert
    restart: always
    volumes:
      - ./conf/tracert/conf.yml:/app/conf.yml
    depends_on:
      - fluentd
 ```

## Configuration

Конфигурация задается файлом `conf.yml`:

```yaml
general:            # основные настройки приложения
  period: 15        # промержуток между выполнением traceroute
  host: ya.ru       # целевой хост
  log_level: info   # Уровень логирования, debug/info/warning и т.д.
  filter: something # используется для фильтрации 

fluent:             # настройки fluentd
  host: localhost   
  port: 24224
  tag: tracert
  ```


## About

Привет!

Собственно, история появления данной софтины банальна - во время работы в одной из компаний, которая занимается разработкой и дальнейшим обслуживанием сайтов, поступила задача, мол, "так и так, нам нужно измерять производительность сети и сохранять логи, дабы заказчику в случае чего было, с чем идти к хостер-провайдеру".

Все, что данный скриптик умеет делать - это циклично выполнять `traceroute`, кое-как парсить результаты выполнения команды и отправлять его в **FluentD**.

Из того, что оно **не умеет** - если результат `traceroute` такой:

```
12  172.253.51.223 (172.253.51.223)  23.430 ms
    172.253.51.239 (172.253.51.239)  22.798 ms
    172.253.51.237 (172.253.51.237)  23.714 ms
```
или такой:
```
 6  108.170.250.83 (108.170.250.83)  15.531 ms 108.170.250.130 (108.170.250.130)  15.862 ms 108.170.250.83 (108.170.250.83)  14.189 ms
 ```
 То ничего не выйдет, ибо я не настолько классный пограммист, дабы на лету определять формат возвращаемых данных.

 Оно точно будет работать, если формат возращаемых данных будет таким:
 ```
  3  aurora.yndx.net (194.226.100.90)  0.437 ms  0.438 ms  0.425 ms
  4  ya.ru (87.250.250.242)  10.831 ms  10.826 ms  10.791 ms
```
Т.е. `порядковый номер домен (Ip) время ms время ms время ms`

Из дополнительного функционала - есть возможность выставить фильтр (например, если вас интересуют только узлы определенного хостера).

